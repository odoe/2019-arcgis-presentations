<!DOCTYPE html>
<html>
<head>

<meta charset="utf-8">
<meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no">
<title>Election</title>

<style>
  html,
  body,
  #viewDiv {
    padding: 0;
    margin: 0;
    height: 100%;
    width: 100%;
  }
</style>

<link rel="stylesheet" href="https://js.arcgis.com/4.13/esri/css/main.css">
<script src="https://js.arcgis.com/4.13/"></script>

<script>
require([
  "esri/Map",
  "esri/layers/FeatureLayer",
  "esri/views/MapView",
  "esri/widgets/Legend",
  "esri/renderers/UniqueValueRenderer",
  "esri/symbols/SimpleFillSymbol",
  "esri/symbols/SimpleMarkerSymbol"
], function(
  Map,
  FeatureLayer,
  MapView,
  Legend,
  UniqueValueRenderer,
  SimpleFillSymbol,
  SimpleMarkerSymbol
) {


  function createSymbol(color, isMarker){
    var options = {
      color: color,
      outline: {
        color: [ 255, 255, 255, 0.3 ],
        width: 0.5
      },
      size: 6
    };

    return isMarker ? new SimpleMarkerSymbol(options) : new SimpleFillSymbol(options);
  }

  //////////////////////////////////////
  /////   RENDERER   ///////////////////
  //////////////////////////////////////

  const totalVotes = {
    type: "size",
    field: "PRS_TOT_16",  // PRS_TOT_12
    legendOptions: {
      title: "Voter turnout"
    },
    minDataValue: 100,
    maxDataValue: 1000000,
    minSize: "4px",
    maxSize: "60px"
  };

  const percentWinner = {
    type: "opacity",
    field: "GAP16",  // GAP12
    legendOptions: {
      title: "Margin of victory"
    },
    stops: [
      { value: 5, opacity: 0.05, label: "contested" },
      { value: 50, opacity: 0.95, label: "landslide" }
    ]
  };

  const winnerRenderer = new UniqueValueRenderer({
    field: "PRS_PARTY_16",  // PRS_PARTY_12
    defaultSymbol: createSymbol("#a7c636", true),
    defaultLabel: "Other",
    legendOptions: {
      title: "Winner"
    },
    uniqueValueInfos: [{
      value: "Dem",
      symbol: createSymbol("#149ece", true),
      label: "Clinton"
    }, {
      value: "GOP",
      symbol: createSymbol("#ed5151", true),
      label: "Trump"
    }],
    visualVariables: [ percentWinner, totalVotes ]
  });

  const layer = new FeatureLayer({
    url: "https://services.arcgis.com/V6ZHFr6zdgNZuVG0/arcgis/rest/services/us_counties_election_join/FeatureServer/0",
    outFields: [ "*" ],
    title: "Election results (2016) by county",
    renderer: winnerRenderer
  });

  const map = new Map({
    basemap: "gray-vector",
    layers: [ layer ]
  });

  const view = new MapView({
    container: "viewDiv",
    map: map,
    center: [ -95, 38 ],
    zoom: 4
  });

  const legend = new Legend({
    view: view
  });
  view.ui.add(legend, "bottom-left");
});
</script>
</head>

<body>
  <div id="viewDiv"></div>
</body>

</html>